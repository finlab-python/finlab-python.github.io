(window.webpackJsonp=window.webpackJsonp||[]).push([[110,43],{476:function(t,e,n){t.exports={}},507:function(t,e,n){t.exports={}},508:function(t,e,n){"use strict";n(476)},513:function(t,e,n){"use strict";n.r(e);n(23),n(44);var r={props:{vip:{default:!1}},data:function(){return{fakeData:[["1258 其祥-KY",-.24226804123711343,.1,"2021-01-01"],["1336 台翰",-.015452538631346768,.1,"2021-01-01"],["1413 宏洲",-.08035714285714313,.1,"2021-01-01"],["1528 恩德",-.08727858293075608,.1,"2021-01-01"],["8916 光隆",.10973451327433681,.1,"2021-01-01"],["9962 有益",.00964630225080354,.1,"2021-01-01"]]}},methods:{stockReturnColor:function(t){return 0===t?"gray":t>0?"#ff3385":"#08c79e"},sign:function(t){return t>0?"+"+t.toString():t.toString()}}},o=(n(508),n(52)),component=Object(o.a)(r,function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"uk-inline uk-width-1-1",staticStyle:{"overflow-x":"hidden"}},[e("table",{staticClass:"uk-table uk-table-divider uk-width-1-1",staticStyle:{"white-space":"nowrap"}},[t._m(0),t._v(" "),e("tbody",t._l(t.fakeData,function(n){return e("tr",{key:n[0]},[e("td",{staticClass:"uk-text-primary"},[t._v(t._s(n[0]))]),t._v(" "),e("td",{style:"color:".concat(t.stockReturnColor(n[1]))},[t._v("\n            "+t._s(Math.round(100*t.sign(n[1]))/100)+"%\n          ")]),t._v(" "),e("td",{style:"color:".concat(t.stockReturnColor(n[2]))},[t._v("\n            "+t._s(100*n[2])+" %\n          ")]),t._v(" "),e("td",{staticClass:"uk-text-right"},[t._v(t._s(n[3]))])])}),0)]),t._v(" "),e("div",{staticClass:"blur uk-position-cover uk-overlay uk-overlay-default uk-flex uk-flex-center uk-flex-middle"},[e("nuxt-link",{attrs:{to:"/pricing"}},[t.vip?e("div",{staticClass:"uk-text-center vip uk-text-primary",attrs:{"uk-scrollspy":"cls: uk-animation-kenburns; repeat: true"}},[e("span",{attrs:{"uk-icon":"icon: lock; ratio: 3.5"}}),t._v(" "),e("h2",{staticClass:"uk-text-primary"},[t._v("FinLab VIP")]),t._v(" "),e("p",[t._v("\n            學程式、練投資一切搞定\n          ")])]):t._e()]),t._v(" "),t.vip?t._e():e("a",{attrs:{"uk-toggle":"target: #login-ui"}},[t._m(1)])],1)])])},[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("名稱")]),t._v(" "),e("th",[t._v("漲跌")]),t._v(" "),e("th",[t._v("權重")]),t._v(" "),e("th",{staticClass:"uk-text-right"},[t._v("清單新增")])])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"uk-text-center vip uk-text-primary",attrs:{"uk-scrollspy":"cls: uk-animation-kenburns; repeat: true"}},[e("span",{attrs:{"uk-icon":"icon: lock; ratio: 3.5"}}),t._v(" "),e("h2",{staticClass:"uk-text-primary"},[t._v("FinLab")]),t._v(" "),e("p",[t._v("\n            登入查看符合條件的清單\n          ")])])}],!1,null,"96fe9148",null);e.default=component.exports},531:function(t,e,n){"use strict";n.r(e);n(65),n(86);var r=n(21),o=n(12),l=(n(74),n(429),n(23),n(30),n(44),n(194),n(64),n(38),n(43),n(6)),c=n(26),d=n(122),_=n.n(d),f=Object(l.b)({components:{},props:{uid:{default:null,type:String},strategy_id:{default:null,type:String},position_id:{default:null,type:String},positionPredefined:{default:null,type:Object}},data:function(){var t=this;return window.goto=function(link){t.$router.push(link)},{showInfo:!1,position:null,mounted:!1,tableMode:"present",displayTableMode:["當前統計","近期更動清單"],sortTableCol:"股票",sortAscending:!0,table:[],weights:{},userCap:20,colabLink:null,buildingColab:!1,next_trading_date:null,update_date:null,last_updated:null,trade_at:null,stop_loss:-1/0,take_profit:1/0,displayStockId:"",failed:!1,freq:"1d"}},mounted:function(){this.init(),this.mounted=!0},methods:{openStockPanel:function(s){this.displayStockId=s.split(" ")[0],window.scrollTo(document.getElementById("stock-id-".concat(s)).top)},showStock:function(s){this.displayStockId=s,_.a.modal("#modal-stock").show()},setSortColumn:function(col){this.sortTableCol===col?this.sortAscending=!this.sortAscending:this.sortAscending=!1,this.sortTableCol=col},init:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark(function e(){var n,o,l,d,table,p,_,f,v,k,h,x,y,C,m,w;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.strategy_id&&t.position_id||t.positionPredefined){e.next=1;break}return e.abrupt("return");case 1:if(n=null,!t.positionPredefined){e.next=2;break}n=t.positionPredefined,e.next=5;break;case 2:return e.prev=2,e.next=3,c.c.collection("users").doc(t.uid).collection("strategies").doc(t.strategy_id).collection("positions").doc(t.position_id).get();case 3:o=e.sent,l=o.data(),n="position"in l?l.position:l,console.log(n),e.next=5;break;case 4:return e.prev=4,C=e.catch(2),console.log("PositionPanel: cannot read position "+C),t.failed=!0,e.abrupt("return");case 5:d=n,t.next_trading_date=d.next_trading_date,t.update_date=d.update_date,t.trade_at=d.trade_at,t.last_updated=d.last_updated.toDate(),t.position=d,table=[],t.weights={},m=regeneratorRuntime.keys(d);case 6:if((w=m()).done){e.next=9;break}if(p=w.value,_=d[p],"object"===Object(r.a)(_)){e.next=7;break}return"freq"==p?t.freq=_:"stop_loss"===p?t.stop_loss=_:"take_profit"===p&&(t.take_profit=_),e.abrupt("continue",6);case 7:if("NaT"===_.exit_date&&(_.exit_date=""),_.exit_date,"weight"in _||"return"in _){e.next=8;break}return e.abrupt("continue",6);case 8:f={close:"收盤",open:"開盤","open|close":"盤中"},v=t.trade_at in f?f[t.trade_at]:t.trade_at,console.log(v,t.trade_at),k={hold:"持有",exit:"移除",enter:"新增",sl:"".concat(v,"停損"),tp:"".concat(v,"停利"),sl_:"已停損",tp_:"已停利","買進":"新增","賣出":"移除","停損停利":_.return>0?"".concat(v,"停利"):"".concat(v,"停損")},h=_.status in k?k[_.status]:_.status,x=0,"next_weight"in _&&(x=_.next_weight),"string"==typeof _.exit_date&-1!=_.exit_date.indexOf("T")&&(_.exit_date=_.exit_date.split("T")[0]),"string"==typeof _.entry_date&-1!=_.entry_date.indexOf("T")&&(_.entry_date=_.entry_date.split("T")[0]),y={stock:p,action:h,profit:Math.round(1e3*_.return)/10,weight:Math.round(1e3*_.weight)/10,nextWeight:Math.round(1e3*x)/10,entry_sig_date:_.entry_date,exit_sig_date:_.exit_date,entry_price:_.entry_price},table.push(y),"買進"==_.status||"entry"==_.status?t.update_date=_.entry_date:"賣出"!=_.status&&"exit"!=_.status||(t.update_date=_.exit_date),"weight"in _&&(t.weights[p]=_.weight),e.next=6;break;case 9:t.table=table;case 10:case"end":return e.stop()}},e,null,[[2,4]])}))()},stockStatusColor:function(t){var output={"新增":"gray","持有":"lightgray","移除":"gray","停損停利":"#252786"};return t in output?output[t]:"gray"},stockReturnColor:function(t){return 0===t?"gray":t>0?"#ff3385":"#08c79e"},sign:function(t){return t>0?"+"+t.toString():t.toString()},formatDate:function(t){if(null===t)return"";var e=new Date,n=t.toLocaleString("en-us").replace(/(\d+)\/(\d+)\/(\d+)/,"$3-$1-$2").replace(/(\d+):(\d+):(\d+)/,"$1:$2").split(", ");return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()?n[1]:n[0]},generate_colab_script:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark(function e(){var n,r,o,l,c,d,_;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in t.buildingColab=!0,n="",t.weights)o=r.match(/\d+/)[0],n+='  "'.concat(o,'" : ').concat(t.weights[r],",\n");return l=["!pip install finlab -q","from finlab.online.order_executor import OrderExecutor\n\noe = OrderExecutor.from_weights({\n\n".concat(n,"\n}, ").concat(1e4*t.userCap,")"),"# 查看欲執行的委託單：\noe._calculate_new_orders()","# 市價下單（所有委託單）\noe.create_orders()","# 更新委託單價格到市價（所有未成交委託單）\noe.create_orders()","# 刪單（所有委託單）\noe.cancel_orders()"],c=null,e.prev=1,d={sid:t.$props.strategy_id,uid:t.$props.uid,code:JSON.stringify(l)},e.next=2,t.$axios.post("https://asia-northeast1-fdata-299302.cloudfunctions.net/generate_colab_strategy",d);case 2:c=e.sent,e.next=4;break;case 3:return e.prev=3,_=e.catch(1),alert("upload colab fail: "+_.data+" "+_),console.log(_),e.abrupt("return");case 4:t.colabLink=c.data;case 5:case"end":return e.stop()}},e,null,[[1,3]])}))()}},computed:{filteredCols:function(){return this.$store.state.user&&this.$route.query.uid===this.$store.state.user.uid?"present"===this.tableMode?["名稱","漲跌","權重","進場價格","清單新增"]:["名稱","新增移除","漲跌","權重更新","清單新增","清單移除"]:"present"===this.tableMode?["名稱","漲跌","權重","清單新增"]:["名稱","新增移除","漲跌","權重更新","清單新增","清單移除"]},realNextTradingDate:function(){if(0===this.table.length)return"";var t="1977-01-01";for(var e in this.table){var n=Object.assign({},this.table[e]);n.entry_sig_date>t&&(t=n.entry_sig_date),n.exit_sig_date>t&&(t=n.exit_sig_date)}return t},rows:function(){var t=this;if(0===this.table.length)return[];var e=[];for(var n in this.table)if("present"!==this.tableMode||0!=this.table[n].weight){var r=Object.assign({},this.table[n]);e.push(r)}return e.sort(function(a,b){var e={"名稱":"stock","漲跌":"profit","新增移除":"action","權重":"weight","權重更新":"nextWeight","進場價格":"entry_price","清單新增":"entry_sig_date","清單移除":"exit_sig_date"}[t.sortTableCol];return a[e]<b[e]^t.sortAscending?1:-1}),e},unrealizedReturn:function(){var t=0;for(var e in this.table){var n=this.table[e].weight,r=this.table[e].profit*(n/100);isNaN(r)||(t+=r,n)}return t=Math.round(10*t)/10,isNaN(t)?0:t},realizedReturn:function(){var t=0;for(var e in this.table){var n=this.table[e].weight,r=this.table[e].profit*(n/100);isNaN(r)||"移除"!==this.table[e].action||(t+=r,n)}return t=Math.round(10*t)/10,isNaN(t)?0:t},hasPermission:function(){var t=this.$store.state.strategy.info.public_position,e=null!==this.$store.state.user;return this.userPermission>=t||e&&this.$store.state.user.uid===this.$props.uid},userPermission:function(){return""===this.$store.state.role?0:"free"===this.$store.state.role?1:this.$store.state.role.includes("vip")?2:void 0}},watch:{userPermission:function(){this.init()}}}),v=(n(538),n(52)),component=Object(v.a)(f,function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticStyle:{"padding-bottom":"24px"}},[null===t.$store.state.user?e("div",[e("FakePosition",{attrs:{vip:!1}})],1):t._e(),t._v(" "),null!==t.$store.state.user?e("div",[e("div",{staticClass:"uk-width-1-1"},[e("ul",{staticClass:"uk-flex uk-subnav uk-subnav-divider",attrs:{"uk-margin":""}},[e("li",{staticClass:"{ 'uk-active': tableMode === 'present' }"},[e("a",{on:{click:function(e){t.tableMode="present"}}},[e("div",{staticClass:"uk-text-primary uk-padding-small",staticStyle:{border:"1px solid","border-radius":"12px"},style:{background:"present"===t.tableMode?"#f0f0fa":"white","border-color":"present"===t.tableMode?"blue":"#aaa"}},[t._v("\n              "+t._s(t.displayTableMode[0])+" "),e("br"),t._v(" "),e("span",{staticClass:"uk-text-lead uk-text-bold",style:{color:t.stockReturnColor(t.unrealizedReturn)}},[t._v("\n                "+t._s(t.sign(t.unrealizedReturn))+" %\n              ")])])])]),t._v(" "),e("li",{class:{"uk-active":"future"===t.tableMode}},[e("a",{on:{click:function(e){t.tableMode="future"}}},[e("div",{staticClass:"uk-text-primary uk-padding-small",staticStyle:{border:"1px solid","border-radius":"12px"},style:{background:"future"===t.tableMode?"#f0f0fa":"white","border-color":"future"===t.tableMode?"blue":"#aaa"}},[t._v("\n              "+t._s(t.displayTableMode[1])+" "),e("br"),t._v(" "),e("span",{staticClass:"uk-text-lead uk-text-bold",staticStyle:{color:"#777"}},[t._v(t._s(t.realNextTradingDate))])])])])]),t._v(" "),"future"==t.tableMode?e("div",{staticClass:"uk-text-small uk-card uk-padding-small uk-margin-large-top uk-margin-large-bottom shadow"},[e("p",[t._v("此策略的模擬交易的細節")]),t._v(" "),e("ul",{staticClass:"uk-list"},[e("li",[t._v("於 "+t._s("1d"===t.freq?t.next_trading_date.split("T")[0]:t.next_trading_date)+" 之後的下個交易日\n            接近\n            "+t._s("close"===t.trade_at?"收盤":"開盤")+" 時調整部位\n          ")]),t._v(" "),t.stop_loss!=-1/0||t.take_profit!=1/0?e("li",[t._v("\n\n            "+t._s(t.stop_loss!=-1/0?"停損為".concat(100*t.stop_loss,"%，"):"")+"\n            "+t._s(t.take_profit!=1/0?"停利為".concat(100*t.take_profit,"%，"):"")+"\n            每日盤後檢查，如觸發則於下個交易日的\n            "+t._s("close"===t.trade_at?"收盤":"開盤")+"\n            出場\n          ")]):t._e()])]):t._e(),t._v(" "),t.mounted?e("div",{staticClass:"uk-overflow-auto"},[0!==t.rows.length?e("table",{staticClass:"uk-table uk-table-divider",staticStyle:{"white-space":"nowrap"}},[e("thead",[e("tr",{staticClass:"uk-text-right"},t._l(t.filteredCols,function(n,r){return e("th",{key:"table-col-".concat(n),staticStyle:{"padding-left":"0"},style:0===r?"text-align:left!important":"text-align:right!important",on:{click:function(e){return t.setSortColumn(n)}}},[t._v("\n                "+t._s(n)+"\n                "),t.sortTableCol===n?e("span",[t._v(t._s(t.sortAscending?"▲":"▼"))]):t._e()])}),0)]),t._v(" "),e("tbody",{staticClass:"uk-text-right"},t._l(t.rows,function(n){return e("tr",{key:"table-row-".concat(n.stock)},[t.filteredCols.includes("名稱")?e("td",{staticClass:"uk-text-left",staticStyle:{"padding-left":"0"}},[e("div",{staticClass:"uk-text-primary",staticStyle:{cursor:"pointer"},attrs:{id:"stock-id-".concat(n.stock)},on:{click:function(e){return t.openStockPanel(n.stock)}}},[t._v("\n                  "+t._s(n.stock)+"\n                  "),"持有"!==n.action&&"移除"!==n.action&&"新增"!==n.action?e("span",{staticClass:"round-border uk-background-primary",staticStyle:{"font-size":"0.9rem",color:"white",padding:"0 10px"}},[t._v(t._s(n.action))]):t._e()])]):t._e(),t._v(" "),t.filteredCols.includes("新增移除")?e("td",{style:"color:".concat(t.stockStatusColor(n.action))},[t._v("\n                "+t._s(n.action)+"\n              ")]):t._e(),t._v(" "),t.filteredCols.includes("漲跌")?e("td",{style:"color:".concat(t.stockReturnColor(n.profit))},[t._v("\n                "+t._s(t.sign(n.profit))+"%\n              ")]):t._e(),t._v(" "),t.filteredCols.includes("權重")?e("td",{style:"color:".concat(t.stockReturnColor(n.weight))},[t._v("\n                "+t._s(n.weight)+" %\n              ")]):t._e(),t._v(" "),t.filteredCols.includes("權重更新")?e("td",{style:"color:".concat(t.stockReturnColor(n.nextWeight))},[t._v("\n                "+t._s(n.nextWeight)+" %\n              ")]):t._e(),t._v(" "),t.filteredCols.includes("進場價格")?e("td",[t._v("\n                "+t._s(n.entry_price)+"\n              ")]):t._e(),t._v(" "),t.filteredCols.includes("清單新增")?e("td",[t._v("\n                "+t._s(n.entry_sig_date)+"\n              ")]):t._e(),t._v(" "),t.filteredCols.includes("清單移除")?e("td",[t._v("\n                "+t._s(n.exit_sig_date)+"\n              ")]):t._e()])}),0)]):e("div",[t.failed?e("FakePosition",{attrs:{vip:!0}}):e("span",[t._v("目前策略無持股喔！")])],1)]):t._e(),t._v(" "),e("div",{staticClass:"uk-margin-large-top uk-margin-large-bottom"},[e("p",[t._v("\n          不知道怎麼使用？"),e("br"),t._v("趕快來看\n          "),e("nuxt-link",{attrs:{to:"/course?cid=LqYTLW3KkXRSPnci47xe"}},[e("span",{staticStyle:{"text-decoration":"underline"}},[t._v("平台速成教學")])]),t._v("\n          ！\n        ")],1)])])]):t._e(),t._v(" "),t.displayStockId?e("div",{staticClass:"stock-panel shadow"},[e("a",{staticClass:"uk-icon-button shadow",staticStyle:{border:"1px solid #ccc",top:"3px",right:"6px",position:"absolute","z-index":"100"},attrs:{"uk-icon":"close"},on:{click:function(e){t.displayStockId=""}}}),t._v(" "),e("div",{staticStyle:{height:"100%"}},[e("StockPanel",{attrs:{stock_id:t.displayStockId,displaySearchBar:!1}})],1)]):t._e()])},[],!1,null,"2fdfffc8",null);e.default=component.exports;installComponents(component,{FakePosition:n(513).default,StockPanel:n(498).default})},538:function(t,e,n){"use strict";n(507)}}]);