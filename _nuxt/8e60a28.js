(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{739:function(t,e,r){"use strict";r.r(e);var n=r(12),o=(r(60),r(43),r(6)),c=r(26),l=r(122),d=r.n(l),_=Object(o.b)({data:function(){return{willPaid:!1,deals:{merchant:{price:0,total_count:-1,unit:"月",details:"當前無訂閱任何商品"},transactions:[]}}},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$store.state.user){e.next=1;break}return e.abrupt("return");case 1:return r=t.$store.state.user.uid,e.next=2,c.c.collection("payments").doc(r).get();case 2:n=e.sent,console.log("hello",n.data()),n.exists&&(t.deals=n.data(),"card_token"in t.deals&&(t.willPaid=!0)),console.log("world");case 3:case"end":return e.stop()}},e)}))()},methods:{cancelSubscription:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t,d.a.modal.confirm("您將會失去當前方案的優惠，您確定嗎？").then(Object(n.a)(regeneratorRuntime.mark(function t(){var e,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,c.a.currentUser.getIdToken();case 1:return n=t.sent,e={headers:{Authorization:"Bearer "+n}},console.log(e),t.prev=2,t.next=3,r.$axios.post("https://asia-east1-crypto-296412.cloudfunctions.net/payment-remove-card-token-v1",{},e);case 3:r.willPaid=!1,t.next=5;break;case 4:t.prev=4,o=t.catch(2),console.log(o),void 0!==o.response?d.a.modal.alert("取消訂閱失敗："+o.response.data.msg):alert(o),console.log(o);case 5:case"end":return t.stop()}},t,null,[[2,4]])})),function(){console.log("Rejected.")});case 1:case"end":return e.stop()}},e)}))()}},computed:{role:function(){return this.$store.state.role},expireDate:function(){return this.$store.state.expire_date&&"none"!==this.$store.state.expire_date?this.$store.state.expire_date.slice(0,4)+" / "+this.$store.state.expire_date.slice(4,6)+" / "+this.$store.state.expire_date.slice(6,8):"無"}}}),v=r(52),component=Object(v.a)(_,function(){var t=this,e=t._self._c;t._self._setupProxy;return t.deals?e("div",[e("div",{staticClass:"uk-grid-match uk-child-width-1-2@m",attrs:{"uk-grid":""}},[e("div",[e("div",{staticClass:"uk-card uk-background-default shadow uk-padding"},["vip"===t.role?e("h4",{staticClass:"uk-text-primary"},[t._v("\n          目前方案：FinLab VIP\n        ")]):t._e(),t._v(" "),"vip_m"===t.role?e("h4",{staticClass:"uk-text-primary"},[t._v("\n          目前方案：FinLab VIP 月繳\n        ")]):t._e(),t._v(" "),"vip_y"===t.role?e("h4",{staticClass:"uk-text-primary"},[t._v("\n          目前方案：FinLab VIP 年繳\n        ")]):t._e(),t._v(" "),"vip_t"===t.role?e("h4",{staticClass:"uk-text-primary"},[t._v("\n          目前方案：FinLab VIP 試用（僅資料源）\n        ")]):t._e(),t._v(" "),"free"===t.role?e("h4",{staticClass:"uk-text-primary"},[t._v("\n          目前方案：免費試用\n        ")]):t._e(),t._v(" "),t.deals.merchant&&-1!==t.deals.merchant.total_count?e("span",[t._v("\n          會員 ID： "+t._s(t.deals.merchant.total_count)+" "),e("br")]):t._e(),t._v(" "),t.deals.merchant?e("span",[t._v("\n          含"+t._s(t.deals.merchant.details)),e("br"),t._v("\n          NT "+t._s(t.deals.merchant.price)+" / "+t._s(t.deals.merchant.unit)),e("br")]):t._e()])]),t._v(" "),e("div",[t.willPaid?e("div",{staticClass:"uk-card uk-background-default shadow uk-padding"},[e("h4",{staticClass:"uk-text-primary"},[t._v("下期 VIP 付款日 "+t._s(t.expireDate))]),t._v(" "),e("p",[t._v("付款日後的隔天下午會自動授權下一期的 VIP 會員")]),t._v(" "),e("p",{attrs:{"uk-margin":""}},[e("MerchantCard",{attrs:{changeCreditCard:!0}}),t._v(" "),t.deals.transactions&&t.deals.transactions.length>=12||t.$route.query.debug?e("button",{staticClass:"uk-button uk-button-default",on:{click:t.cancelSubscription}},[t._v("\n            取消訂閱(按下瞬間，將無法還原當初訂閱價格)\n          ")]):e("button",{staticClass:"uk-button uk-button-disable",attrs:{disabled:""}},[t._v("\n            取消訂閱（需訂閱滿 12 個月後方可點選）\n          ")])],1)]):e("div",{staticClass:"uk-card uk-background-default shadow uk-padding"},[e("h4",{staticClass:"uk-text-primary"},[t._v("VIP 截止日 "+t._s(t.expireDate))]),t._v(" "),"free"!==t.role?e("p",[t._v("截止日後的零時將變回 Free 用戶")]):t._e(),t._v(" "),t._m(0)])]),t._v(" "),e("div",{staticClass:"uk-width-1-1"},[e("div",{staticClass:"uk-card uk-background-default shadow uk-padding"},[e("h4",{staticClass:"uk-text-primary"},[t._v("近期訂閱")]),t._v(" "),e("table",{staticClass:"uk-table uk-table-divider"},[t._m(1),t._v(" "),e("tbody",t._l(t.deals.transactions,function(r){return e("tr",{key:r.rec_trade_id},[e("td",[t._v(t._s(r.card_info.last_four))]),t._v(" "),e("td",[t._v(t._s(r.rec_trade_id))]),t._v(" "),e("td",[t._v("\n                "+t._s(new Date(parseInt(r.bank_transaction_time.end_time_millis)).toLocaleString())+"\n              ")]),t._v(" "),e("td",[t._v("NT $"+t._s(r.amount))]),t._v(" "),e("td",[t._v(t._s(r.InvoiceNumber))])])}),0)])])])])]):t._e()},[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("p",{attrs:{else:""}},[t._v("\n          當訂閱後，此處將會顯示"),e("br"),t._v("下次付款日期、換卡、取消訂閱等操作\n        ")])},function(){var t=this,e=t._self._c;t._self._setupProxy;return e("thead",[e("tr",[e("th",[t._v("卡片末四碼")]),t._v(" "),e("th",[t._v("交易序號")]),t._v(" "),e("th",[t._v("付款時間")]),t._v(" "),e("th",[t._v("費用")]),t._v(" "),e("th",[t._v("發票號碼")])])])}],!1,null,null,null);e.default=component.exports;installComponents(component,{MerchantCard:r(740).default})}}]);