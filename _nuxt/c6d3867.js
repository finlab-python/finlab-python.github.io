(window.webpackJsonp=window.webpackJsonp||[]).push([[90,57],{1013:function(t,e,n){"use strict";n.r(e);n(23),n(44);var r=n(12),o=(n(192),n(38),n(43),n(26)),c={data:function(){return{p:{thumbnail:"",id:this.$route.query.postId||Date.now()},postExist:!1,menu:null}},mounted:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.download(t.p.id);case 1:case"end":return e.stop()}},e)}))()},methods:{upload:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark(function e(){var n,i,r,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,r=regeneratorRuntime.keys(t.menu);case 1:if((c=r()).done){e.next=3;break}if(i=c.value,t.menu[i].id!==t.p.id){e.next=2;break}return t.menu[i]=t.p,n=!0,e.abrupt("continue",3);case 2:e.next=1;break;case 3:return n||t.menu.unshift(t.p),e.next=4,o.c.collection("posts").doc("menu").set({posts:t.menu});case 4:t.$refs.post.uploadPost();case 5:case"end":return e.stop()}},e)}))()},download:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark(function n(){var i,r,c,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.p.id=t,n.prev=1,n.next=2,o.c.collection("posts").doc("menu").get();case 2:e.menu=n.sent.data().posts,n.next=4;break;case 3:n.prev=3,r=n.catch(1),alert(r,t,"not found");case 4:c=regeneratorRuntime.keys(e.menu);case 5:if((l=c()).done){n.next=7;break}if(i=l.value,e.menu[i].id!==t){n.next=6;break}return e.p.id=e.menu[i].id,e.p.thumbnail=e.menu[i].thumbnail,e.postExist=!0,console.log("find p",e.p),n.abrupt("continue",7);case 6:n.next=5;break;case 7:e.$refs.post.downloadPost();case 8:case"end":return n.stop()}},n,null,[[1,3]])}))()},remove:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark(function e(){var n,i,r,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=null,r=regeneratorRuntime.keys(t.menu);case 1:if((c=r()).done){e.next=3;break}if(i=c.value,t.menu[i].id!==t.p.id){e.next=2;break}return n=i,e.abrupt("continue",3);case 2:e.next=1;break;case 3:return t.menu.splice(n,1),e.next=4,o.c.collection("posts").doc("menu").set({posts:t.menu});case 4:return e.next=5,o.c.collection("posts").doc(t.p.id.toString()).delete();case 5:case"end":return e.stop()}},e)}))()}}},l=n(52),component=Object(l.a)(c,function(){var t=this,e=t._self._c;return e("div",{staticStyle:{background:"white"}},[e("div",{staticClass:"uk-container uk-padding"},[e("div",{attrs:{"uk-grid":""}},[e("div",{staticClass:"uk-width-2-3"},[e("h2",[t._v(t._s(t.postExist?"修改":"新增")+"公告")]),t._v(" "),e("p",{staticClass:"uk-form-label",attrs:{for:"form-stacked-text"}},[t._v("公告編號："+t._s(t.p.id))]),t._v(" "),t.p.thumbnail?e("img",{staticStyle:{"border-radius":"15px"},attrs:{width:"300px",src:t.p.thumbnail,alt:"image"}}):t._e(),e("br"),t._v(" "),e("label",{staticClass:"uk-form-label",attrs:{for:"form-stacked-text"}},[t._v("縮圖網址")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.p.thumbnail,expression:"p.thumbnail"}],staticClass:"uk-input",attrs:{type:"text",name:"image",id:""},domProps:{value:t.p.thumbnail},on:{input:function(e){e.target.composing||t.$set(t.p,"thumbnail",e.target.value)}}}),t._v(" "),e("label",{staticClass:"uk-form-label",attrs:{for:"form-stacked-text"}},[t._v("內文")]),t._v(" "),e("PostPanel",{ref:"post",attrs:{collection:"posts",document:t.p.id.toString()}}),t._v(" "),e("br"),t._v(" "),e("button",{staticClass:"uk-button uk-button-primary",on:{click:function(e){return t.upload()}}},[t._v(t._s(t.postExist?"修改":"新增"))]),t._v(" "),e("button",{staticClass:"uk-button uk-button-danger",on:{click:function(e){return t.remove()}}},[t._v("移除")])],1),t._v(" "),e("div",{staticClass:"uk-width-1-3"},t._l(t.menu,function(n){return e("img",{key:n.id,staticStyle:{"border-radius":"15px","margin-bottom":"12px"},attrs:{width:"300px",src:n.thumbnail,alt:"image"},on:{click:function(e){return t.download(n.id)}}})}),0)])])])},[],!1,null,null,null);e.default=component.exports;installComponents(component,{PostPanel:n(830).default})},830:function(t,e,n){"use strict";n.r(e);var r=n(12),o=(n(43),n(6)),c=(n(659),n(660),n(661),n(662)),l=n(26),d=Object(o.b)({setup:function(){},props:{collection:{default:null},document:{default:null}},components:{quillEditor:c.quillEditor},data:function(){return{post:"",editorOption:{theme:"snow",placeholder:"策略研發筆記",modules:{syntax:{highlight:function(text){return window.hljs.highlightAuto(text).value}},toolbar:[["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{header:[2,3,!1]}],[{color:[]},{background:[]}],[{size:["small",!1,"large","huge"]}],[{align:[]}],["link","image"],["clean"],["video"],["code-block"]]}}}},methods:{downloadPost:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark(function e(){var n,r,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.collection){e.next=1;break}return e.abrupt("return");case 1:return n=l.c.collection(t.collection).doc(t.document),r=null,e.prev=2,e.next=3,n.get();case 3:r=e.sent,e.next=5;break;case 4:e.prev=4,c=e.catch(2),alert("cannot download post ref"+c.response.data);case 5:r&&r.exists&&(o=r.data(),t.post=o.post,""===t.post&&(t.post=null));case 6:case"end":return e.stop()}},e,null,[[2,4]])}))()},uploadPost:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark(function e(){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.collection){e.next=1;break}return e.abrupt("return");case 1:if(null!==t.post){e.next=2;break}return e.abrupt("return");case 2:return n=l.c.collection(t.collection).doc(t.document),t.uploadingPost=!0,e.prev=3,e.next=4,n.set({post:t.post},{merge:!0});case 4:e.next=6;break;case 5:e.prev=5,r=e.catch(3),alert("上傳 post 失敗："+r.response.data);case 6:t.uploadingPost=!1;case 7:case"end":return e.stop()}},e,null,[[3,5]])}))()}},mounted:function(){console.log("post mounted"),this.downloadPost()},destroyed:function(){console.log("post destroy"),this.uploadPost()}}),m=n(52),component=Object(m.a)(d,function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},model:{value:t.post,callback:function(e){t.post=e},expression:"post"}})],1)},[],!1,null,"29eba03f",null);e.default=component.exports}}]);