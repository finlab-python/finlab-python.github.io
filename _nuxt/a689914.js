(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{829:function(e,t,o){"use strict";o.r(t);o(54),o(75),o(23);var n=o(12),r=(o(74),o(43),o(6)),c=o(26),l=Object(r.b)({data:function(){return{sid:this.$route.query.sid,uid:this.$route.query.uid,new_public_performance:this.$props.public_performance,new_public_position:this.$props.public_position,new_public_code:this.$props.public_code,generatingSocialImage:!1,shareImage:null}},props:{public_performance:!0,public_position:!1,public_code:!1},watch:{public_performance:function(e){this.new_public_performance=e},public_position:function(e){this.new_public_position=e},public_code:function(e){this.new_public_code=e}},methods:{updatePermission:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark(function t(){var o,n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.state.user){t.next=1;break}return alert("請登入來操作"),t.abrupt("return");case 1:if(e.uid===e.$store.state.user.uid){t.next=2;break}return alert("此策略不屬於您，無法更改權限喔！"),t.abrupt("return");case 2:return o=c.c.collection("users").doc(e.uid).collection("strategies").doc(e.sid),t.next=3,o.update({public_performance:e.new_public_performance,public_position:e.new_public_position,public_code:e.new_public_code});case 3:return n=c.c.collection("users").doc(e.uid),(r={})[e.sid]={public_performance:e.new_public_performance,public_position:e.new_public_position,public_code:e.new_public_code},t.next=4,n.set({strategies:r},{merge:!0});case 4:case"end":return t.stop()}},t)}))()},generateSocialImage:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark(function t(){var o,n,r,c,l,d,_;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==e.generatingSocialImage){t.next=1;break}return t.abrupt("return");case 1:return e.generatingSocialImage=!0,o=null,t.prev=2,n="https://asia-east1-fdata-299302.cloudfunctions.net/social-image/?sid=".concat(e.$route.query.sid,"&uid=").concat(e.$route.query.uid,"&photoURL=").concat(e.$store.state.user.photoURL,"&author=").concat(e.$store.state.user.displayName,"&force=true"),r="https://asia-east1-fdata-299302.cloudfunctions.net/social-image/?sid=".concat(e.$route.query.sid,"&uid=").concat(e.$route.query.uid,"&photoURL=").concat(e.$store.state.user.photoURL,"&author=").concat(e.$store.state.user.displayName),t.next=3,e.$axios.get(n);case 3:t.sent,o=r,t.next=5;break;case 4:t.prev=4,d=t.catch(2),console.log("fail to generate image",d);case 5:return t.prev=5,c="https://ai.finlab.tw/strategy/?uid=".concat(e.$route.query.uid,"&sid=").concat(e.$route.query.sid),l={"User-Agent":"facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)",Connection:"close"},t.next=6,e.$axios.get(c,{},{headers:l});case 6:t.sent,t.next=8;break;case 7:t.prev=7,_=t.catch(5),console.log("fail to update crawler",_);case 8:o&&(e.shareImage=o),e.generatingSocialImage=!1;case 9:case"end":return t.stop()}},t,null,[[2,4],[5,7]])}))()}}}),d=o(52),component=Object(d.a)(l,function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"modal-permission","uk-modal":""}},[t("div",{staticClass:"uk-modal-dialog uk-modal-body round-border"},[t("h2",{staticClass:"uk-modal-title"},[e._v("分享")]),e._v("\n    分享績效\n    "),t("div",{staticClass:"uk-margin"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.new_public_performance,expression:"new_public_performance"}],staticClass:"uk-select",on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.new_public_performance=t.target.multiple?o:o[0]}}},[t("option",{domProps:{value:10}},[e._v("隱藏")]),e._v(" "),t("option",{domProps:{value:3}},[e._v("分享於VIP年用戶")]),e._v(" "),t("option",{domProps:{value:2}},[e._v("分享於VIP月用戶")]),e._v(" "),t("option",{domProps:{value:0}},[e._v("分享於所有用戶")])])]),e._v("\n    分享選股標的\n    "),t("div",{staticClass:"uk-margin"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.new_public_position,expression:"new_public_position"}],staticClass:"uk-select",on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.new_public_position=t.target.multiple?o:o[0]}}},[t("option",{domProps:{value:10}},[e._v("隱藏")]),e._v(" "),t("option",{domProps:{value:3}},[e._v("分享於VIP年用戶")]),e._v(" "),t("option",{domProps:{value:2}},[e._v("分享於VIP月用戶")]),e._v(" "),t("option",{domProps:{value:0}},[e._v("分享於所有用戶")])])]),e._v("\n    分享程式碼\n    "),t("div",{staticClass:"uk-margin"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.new_public_code,expression:"new_public_code"}],staticClass:"uk-select",on:{change:function(t){var o=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.new_public_code=t.target.multiple?o:o[0]}}},[t("option",{domProps:{value:10}},[e._v("隱藏")]),e._v(" "),t("option",{domProps:{value:3}},[e._v("分享於VIP年用戶")]),e._v(" "),t("option",{domProps:{value:2}},[e._v("分享於VIP月用戶")]),e._v(" "),t("option",{domProps:{value:0}},[e._v("分享於所有用戶")])])]),e._v(" "),t("div",{staticClass:"uk-margin-large",staticStyle:{border:"1px solid #ddd"}},[0===e.$props.public_performance&&this.$store.state.user?t("button",{staticClass:"uk-button",on:{click:e.generateSocialImage}},[e._v("\n        "+e._s(!1===e.generatingSocialImage?"產生分享圖片":"產生中(約30秒)...")+"\n      ")]):e._e(),e._v(" "),e.shareImage?t("img",{attrs:{width:"100%",src:e.shareImage,alt:"顯示圖片"}}):e._e()]),e._v(" "),t("p",{staticClass:"uk-text-right"},[t("button",{staticClass:"uk-button uk-button-default uk-modal-close",attrs:{type:"button"}},[e._v("\n        取消\n      ")]),e._v(" "),t("button",{staticClass:"uk-button uk-button-primary uk-modal-close",attrs:{type:"button"},on:{click:e.updatePermission}},[e._v("\n        確認\n      ")])])])])},[],!1,null,null,null);t.default=component.exports}}]);