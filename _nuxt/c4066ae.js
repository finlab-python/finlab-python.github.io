(window.webpackJsonp=window.webpackJsonp||[]).push([[22,21],{431:function(e,t,o){"use strict";var n=o(5),l=o(8),r=o(55),c=o(50),d=o(76),m=o(274),f=o(24),y=o(9),h=o(275),_=o(190),v=o(440),k=o(441),C=o(120),x=o(442),T=[],w=l(T.sort),P=l(T.push),O=y(function(){T.sort(void 0)}),R=y(function(){T.sort(null)}),D=_("sort"),E=!y(function(){if(C)return C<70;if(!(v&&v>3)){if(k)return!0;if(x)return x<603;var code,e,t,o,n="";for(code=65;code<76;code++){switch(e=String.fromCharCode(code),code){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(o=0;o<47;o++)T.push({k:e+o,v:t})}for(T.sort(function(a,b){return b.v-a.v}),o=0;o<T.length;o++)e=T[o].k.charAt(0),n.charAt(n.length-1)!==e&&(n+=e);return"DGBEFHACIJK"!==n}});n({target:"Array",proto:!0,forced:O||!R||!D||!E},{sort:function(e){void 0!==e&&r(e);var t=c(this);if(E)return void 0===e?w(t):w(t,e);var o,n,l=[],y=d(t);for(n=0;n<y;n++)n in t&&P(l,t[n]);for(h(l,function(e){return function(t,o){return void 0===o?-1:void 0===t?1:void 0!==e?+e(t,o)||0:f(t)>f(o)?1:-1}}(e)),o=d(l),n=0;n<o;)t[n]=l[n++];for(;n<y;)m(t,n++);return t}})},440:function(e,t,o){"use strict";var n=o(85).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},441:function(e,t,o){"use strict";var n=o(85);e.exports=/MSIE|Trident/.test(n)},442:function(e,t,o){"use strict";var n=o(85).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},540:function(e,t,o){e.exports={}},551:function(e,t,o){"use strict";o.r(t);var n=o(618),l=o.n(n),r={name:"BlocklyComponent",props:["options","value","height"],data:function(){return{workspace:null,initialValue:this.$props.value}},mounted:function(){console.log("start mounted component");var e=this.$props.options||{};e.toolbox||(e.toolbox=this.$refs.blocklyToolbox),this.workspace=l.a.inject(this.$refs.blocklyDiv,e);var t=l.a.Xml.textToDom(this.initialValue);l.a.Xml.domToWorkspace(t,this.workspace),console.log("end mounted component")},methods:{injectCode:function(e){var t=l.a.Xml.textToDom(e);this.workspace.clear(),l.a.Xml.domToWorkspace(t,this.workspace)},injectAdditionCode:function(e){var t=l.a.Xml.textToDom(e);console.log("blockly component get xml",t),l.a.Xml.domToWorkspace(t,this.workspace)},getCode:function(){var e=l.a.Xml.workspaceToDom(this.workspace);return l.a.Xml.domToText(e)}},beforeDestroy:function(){var code=this.getCode();this.$emit("input",code)}},c=(o(571),o(52)),component=Object(c.a)(r,function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%",height:"100%"}},[t("div",{ref:"blocklyDiv",staticClass:"blocklyDiv",style:"height:".concat(this.$props.height)}),e._v(" "),e._m(0)],1)},[function(){return(0,this._self._c)("xml",{pre:!0,attrs:{ref:"blocklyToolbox",style:"display: none"}},[this._t("default")],2)}],!1,null,"1a7cf05c",null);t.default=component.exports},557:function(e,t,o){e.exports={}},571:function(e,t,o){"use strict";o(540)},576:function(e,t,o){"use strict";o.r(t);o(30),o(64);var n=o(551),l=(o(74),o(148),o(431),o(531)),r=o(572),c=o.n(r),d=200;function m(e,t){""===(t=t.split("#$"))[t.length-1]&&t.pop();var code=t=t.join("\n###"+e);return"("+(code=(code=code.replace(/ /g,"")).replace(/#/g," "))+")"}l.HSV_SATURATION=.3,l.HSV_VALUE=.8,l.defineBlocksWithJsonArray([{type:"data_type",message0:"資料 %1",args0:[{type:"field_input",name:"dataName",text:"price:收盤價"}],output:null,colour:230,tooltip:"",helpUrl:""},{type:"indicator",message0:"技術指標 %1",args0:[{type:"field_input",name:"dataName",text:"RSI(timeperiod=20)"}],output:null,colour:230,tooltip:"",helpUrl:""},{type:"df_rolling",message0:"近 %1 筆 %2 的 %3",args0:[{type:"field_number",name:"window",value:10},{type:"input_value",name:"df"},{type:"field_dropdown",name:"operation",options:[["平均","mean"],["總和","sum"],["最大值","max"],["最小值","min"]]}],inputsInline:!0,output:null,colour:200,tooltip:"",helpUrl:""},{type:"backtest",message0:"回測條件 %1 %2  %3 換股頻率 %4",args0:[{type:"field_dropdown",name:"operator",options:[["and","&"],["or","|"]]},{type:"input_dummy"},{type:"input_statement",name:"total_conditions"},{type:"field_dropdown",name:"rebalance_frequency",options:[["每日","D"],["每週","W"],["每月","M"],["每季","Q"]]}],inputsInline:!1,colour:0,tooltip:"",helpUrl:""},{type:"numerical_operator",message0:"%1 %2 %3 %4",args0:[{type:"input_value",name:"val_1"},{type:"field_dropdown",name:"operations",options:[["+","+"],["-","-"],["x","*"],["/","/"]]},{type:"input_dummy"},{type:"input_value",name:"val_2"}],inputsInline:!0,output:null,colour:d,tooltip:"",helpUrl:""},{type:"inequality",message0:"%1 %2 %3 %4",args0:[{type:"input_value",name:"val_1"},{type:"field_dropdown",name:"inequality",options:[[">",">"],["≥",">="],["<","<"],["≤","<="],["=","="]]},{type:"input_dummy"},{type:"input_value",name:"val_2"}],previousStatement:null,nextStatement:null,colour:d,tooltip:"",helpUrl:""},{type:"logic_conditions",message0:"%1 條件: %2 %3",args0:[{type:"field_dropdown",name:"operator",options:[["and","&&"],["or","||"]]},{type:"input_dummy"},{type:"input_statement",name:"Condition"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:50,tooltip:"",helpUrl:""},{type:"sort",message0:"%1 %2 %3",args0:[{type:"field_dropdown",name:"option",options:[["前","nlargest"],["後","nsmallest"]]},{type:"field_number",name:"threshold",value:10},{type:"field_dropdown",name:"unit",options:[["名","n"],["%","percent"]]}],message1:"%1",args1:[{type:"input_value",name:"value"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:200,tooltip:"",helpUrl:""},{type:"sort_condition",message0:"符合條件 %1 %2 %3",args0:[{type:"field_dropdown",name:"operator",options:[["And","&"],["Or","|"]]},{type:"input_dummy",name:"dummy"},{type:"input_statement",name:"statements"}],message1:"的股票中，數值 %1 排名 %2 %3 %4",args1:[{type:"input_value",name:"value"},{type:"field_dropdown",name:"option",options:[["前","nlargest"],["後","nsmallest"]]},{type:"field_number",name:"threshold",value:10},{type:"field_dropdown",name:"unit",options:[["名","n"],["%","percent"]]}],inputsInline:!1,previousStatement:null,nextStatement:null,colour:50,tooltip:"",helpUrl:""},{type:"shift",message0:"前 %1 筆 %2",args0:[{type:"field_number",name:"nshift",value:1,min:0},{type:"input_value",name:"df"}],inputsInline:!1,output:null,colour:d,tooltip:"",helpUrl:""}]),l.Python.sort_condition=function(e){var t=e.getFieldValue("option"),o=e.getFieldValue("threshold"),n=e.getFieldValue("unit"),r=l.Python.valueToCode(e,"value",l.Python.ORDER_ATOMIC),c=l.Python.statementToCode(e,"statements");c=m(e.getFieldValue("operator"),c);var code="(((".concat(r,") * (").concat(c,"))");return"nlargest"===t&&"n"===n?code+=".astype(float).is_largest("+o+"))":"nsmallest"===t&&"n"===n?code+=".astype(float).is_smallest("+o+"))":"nlargest"===t&&"percent"===n?code+=".rank(pct=True) > ".concat(o/100,"))"):"nsmallest"===t&&"percent"===n&&(code+=".rank(pct=True) < ".concat(o/100,"))")),code},l.Python.sort=function(e){var t=e.getFieldValue("option"),o=e.getFieldValue("threshold"),n=e.getFieldValue("unit"),r=l.Python.valueToCode(e,"value",l.Python.ORDER_ATOMIC),code="";return"nlargest"===t&&"n"===n?code=r+".is_largest("+o+")":"nsmallest"===t&&"n"===n?code=r+".is_smallest("+o+")":"nlargest"===t&&"percent"===n?code="("+r+".rank(pct=True) > ".concat(o/100,")"):"nsmallest"===t&&"percent"===n&&(code="("+r+".rank(pct=True) < ".concat(o/100,")")),code},l.Python.backtest=function(e){var t=e.getFieldValue("operator"),o=l.Python.statementToCode(e,"total_conditions"),n=(l.Python.valueToCode(e,"weight",l.Python.ORDER_ATOMIC),e.getFieldValue("rebalance_frequency")),code="from finlab import backtest\n";return code+="from finlab import data\n\n",code+="buy = "+m(t,o)+"\n\n",code+='backtest.sim(buy, resample="'+n+'")\n'},l.Python.df_rolling=function(e){var t=e.getFieldValue("window"),o=l.Python.valueToCode(e,"df",l.Python.ORDER_ATOMIC),n=e.getFieldValue("operation");return["(".concat(o,").rolling(").concat(t,").").concat(n,"()"),l.Python.ORDER_NONE]},l.Python.logic_conditions=function(e){return[m(e.getFieldValue("operator"),l.Python.statementToCode(e,"Condition")),l.Python.ORDER_NONE]},l.Python.data_type=function(e){var t=e.getFieldValue("dataName");return['data.get("'.concat(t,'")'),l.Python.ORDER_NONE]},l.Python.indicator=function(e){var t=e.getFieldValue("dataName"),o=t.split("(")[0],n=t.split("(")[1].replace(")","");return['data.indicator("'.concat(o,'", ').concat(n,")"),l.Python.ORDER_NONE]},l.Python.numerical_operator=function(e){var t=l.Python.valueToCode(e,"val_1",l.Python.ORDER_ATOMIC),o=e.getFieldValue("operations"),n=l.Python.valueToCode(e,"val_2",l.Python.ORDER_ATOMIC);return["(".concat(t).concat(o).concat(n,")"),l.Python.ORDER_NONE]},l.Python.inequality=function(e){var t=l.Python.valueToCode(e,"val_1",l.Python.ORDER_ATOMIC),o=e.getFieldValue("inequality"),n=l.Python.valueToCode(e,"val_2",l.Python.ORDER_ATOMIC);return"(".concat(t).concat(o).concat(n,")")+"#$"},l.Python.shift=function(e){var t=e.getFieldValue("nshift"),o=l.Python.valueToCode(e,"df",l.Python.ORDER_ATOMIC);return["(".concat(o,").shift(").concat(t,")"),l.Python.ORDER_NONE]};var f={name:"app",components:{BlocklyComponent:n.default},props:["value","height"],data:function(){return{xml:this.$props.value,code:"",options:{grid:{spacing:18,length:3,colour:"#ccc",snap:!1},zoom:{controls:!0,wheel:!0,startScale:.9,maxScale:3,minScale:.3,scaleSpeed:1.2},collapse:!0,toolboxPosition:"start",comments:!1,disable:!1,maxBlocks:1/0,trashcan:!0,horizontalLayout:!0,scrollbars:!0,sounds:!0,oneBasedIndex:!1,toolbox:'<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">\n    <block type="data_type">\n      <field name="NAME">price:收盤價</field>\n    </block>\n    <block type="indicator">\n      <field name="NAME"></field>\n    </block>\n    <block type="math_number">\n      <field name="NUM">0</field>\n    </block>\n    <block type="inequality">\n      <field name="inequality">&gt;</field>\n    </block>\n    <block type="numerical_operator">\n      <field name="operations">+</field>\n    </block>\n    <block type="df_rolling">\n      <field name="window">10</field>\n      <field name="operation">mean</field>\n    </block>\n    <block type="sort">\n      <field name="option">nlargest</field>\n      <field name="threshold">10</field>\n      <field name="unit">n</field>\n    </block>\n    <block type="shift">\n      <field name="nshift">1</field>\n    </block>\n    <block type="logic_conditions">\n      <field name="operator">&amp;&amp;</field>\n    </block>\n    <block type="sort_condition">\n      <field name="option">nlargest</field>\n      <field name="threshold">10</field>\n      <field name="unit">n</field>\n    </block>\n    <block type="backtest">\n      <field name="operator">&amp;=</field>\n      <field name="rebalance_frequency">D</field>\n    </block>\n  </xml>'}}},mounted:function(){this.injectCode(this.$props.value)},methods:{getCode:function(){return console.log("get py code"),this.code=c.a.workspaceToCode(this.$refs.foo.workspace),this.code=this.code.replace(/#\$/g,""),console.log(this.code),console.log("get py code done"),[this.code,this.$refs.foo.getCode()]},injectCode:function(e){this.$refs.foo.injectCode(e)},injectAdditionCode:function(e){this.$refs.foo.injectAdditionCode(e)}},beforeDestroy:function(){console.log("before destroy event");var code=this.$refs.foo.getCode();this.$emit("input",code)}},y=(o(619),o(52)),component=Object(y.a)(f,function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%",height:"100%"},attrs:{id:"app"}},[t("BlocklyComponent",{ref:"foo",attrs:{id:"blockly2",options:e.options,height:e.$props.height},model:{value:e.xml,callback:function(t){e.xml=t},expression:"xml"}})],1)},[],!1,null,null,null);t.default=component.exports;installComponents(component,{BlocklyComponent:o(551).default})},619:function(e,t,o){"use strict";o(557)}}]);